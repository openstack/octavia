- job:
    name: octavia-grenade
    parent: grenade
    nodeset: octavia-single-node-ubuntu-jammy
    required-projects: &o-grenade-required-projects
      - opendev.org/openstack/grenade
      - opendev.org/openstack/octavia
      - opendev.org/openstack/octavia-lib
      - opendev.org/openstack/octavia-tempest-plugin
      - opendev.org/openstack/python-octaviaclient
    vars: &o-grenade-vars
      grenade_devstack_localrc:
        shared:
          DIB_LOCAL_ELEMENTS: openstack-ci-mirrors
          LIBVIRT_TYPE: kvm
          LIBVIRT_CPU_MODE: host-passthrough
      devstack_local_conf:
        test-config:
          "$TEMPEST_CONFIG":
            load_balancer:
              check_interval: 1
              check_timeout: 180
      devstack_plugins:
        neutron: https://opendev.org/openstack/neutron.git
        octavia: https://opendev.org/openstack/octavia.git
        octavia-tempest-plugin: https://opendev.org/openstack/octavia-tempest-plugin.git
      devstack_services:
        s-account: false
        s-container: false
        s-object: false
        s-proxy: false
        c-api: false
        c-bak: false
        c-vol: false
        cinder: false
        octavia: true
        o-api: true
        o-cw: true
        o-hm: true
        o-hk: true
      tempest_plugins:
        - octavia-tempest-plugin
      tempest_test_regex: ^octavia_tempest_plugin.*\[.*\bsmoke\b.*\]
      tox_envlist: all
      zuul_copy_output:
        '/var/log/dib-build/': 'logs'
        '/var/log/octavia-tenant-traffic.log': 'logs'
        '/var/log/octavia-amphora.log': 'logs'

- job:
    name: octavia-v2-dsvm-scenario-traffic-ops-jobboard
    parent: octavia-v2-dsvm-scenario-traffic-ops
    vars:
      devstack_localrc:
        OCTAVIA_ENABLE_AMPHORAV2_JOBBOARD: True

- job:
    name: octavia-v2-dsvm-scenario-non-traffic-ops-jobboard
    parent: octavia-v2-dsvm-scenario-non-traffic-ops
    vars:
      devstack_localrc:
        OCTAVIA_ENABLE_AMPHORAV2_JOBBOARD: True

- project-template:
    name: octavia-tox-tips
    check:
      jobs:
        - octavia-tox-py39-tips
        - octavia-tox-functional-py39-tips

- project-template:
    name: octavia-tox-sqlalchemy-tips
    check:
      jobs:
        - octavia-tox-functional-py39-sqlalchemy-tips

- job:
    name: octavia-tox-py39-tips
    parent: openstack-tox-py39
    description: |
      Run tox python 3.9 unit tests against master of related libraries.
    vars:
      tox_install_siblings: true
      zuul_work_dir: src/opendev.org/openstack/octavia
    required-projects:
      - openstack/octavia-lib
      - openstack/octavia

- job:
    name: octavia-tox-functional-py39-tips
    parent: openstack-tox-functional-py39
    description: |
      Run tox python 3.9 functional against master of related libraries.
    vars:
      tox_install_siblings: true
      zuul_work_dir: src/opendev.org/openstack/octavia
    required-projects:
      - openstack/octavia-lib
      - openstack/octavia

- job:
    name: openstack-tox-pip-check-reqs
    parent: openstack-tox
    description: |
      Run pip-missing-reqs and pip-extra-reqs tests to check for missing or
      extra requirements.txt entries.

      Uses tox with the ``pip-missing-reqs``  and ``pip-extra-reqs``
      environments.
    required-projects:
        - openstack/octavia
    vars:
      tox_envlist: pip-missing-reqs,pip-extra-reqs

- job:
    name: octavia-grenade-unmaintained-2024-1
    parent: octavia-grenade
    vars: &advanced_rbac_vars
      devstack_local_conf:
        test-config:
          "$TEMPEST_CONFIG":
            load_balancer:
              RBAC_test_type: advanced

- job:
    name: octavia-v2-dsvm-scenario-traffic-ops-jobboard-unmaintained-2024-1
    parent: octavia-v2-dsvm-scenario-traffic-ops-jobboard
    vars: *advanced_rbac_vars

- job:
    name: octavia-v2-dsvm-scenario-non-traffic-ops-jobboard-unmaintained-2024-1
    parent: octavia-v2-dsvm-scenario-non-traffic-ops-jobboard
    vars: *advanced_rbac_vars

- job:
    name: octavia-v2-dsvm-noop-api-unmaintained-2024-1
    parent: octavia-v2-dsvm-noop-api
    nodeset: octavia-single-node-ubuntu-jammy
    vars: *advanced_rbac_vars

- job:
    name: octavia-v2-dsvm-scenario-unmaintained-2024-1
    parent: octavia-v2-dsvm-scenario
    nodeset: octavia-single-node-ubuntu-jammy
    vars: *advanced_rbac_vars

- job:
    name: octavia-v2-dsvm-scenario-traffic-ops-unmaintained-2024-1
    parent: octavia-v2-dsvm-scenario-unmaintained-2024-1
    vars:
      tempest_test_regex: ^octavia_tempest_plugin.tests.scenario.v2.*traffic_ops

- job:
    name: octavia-v2-dsvm-scenario-non-traffic-ops-unmaintained-2024-1
    parent: octavia-v2-dsvm-scenario-unmaintained-2024-1
    vars:
      tempest_test_regex: ^octavia_tempest_plugin.tests.scenario.v2.(?!.*traffic_ops)

- job:
    name: octavia-v2-dsvm-tls-barbican-unmaintained-2024-1
    parent: octavia-v2-dsvm-tls-barbican
    nodeset: octavia-single-node-ubuntu-jammy
    vars: *advanced_rbac_vars
